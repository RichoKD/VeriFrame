version: "3.8"

services:
  starknet-devnet:
    image: shardlabs/starknet-devnet:latest
    container_name: starknet-devnet
    ports:
      - "5050:5050"
    command: ["--seed", "42", "--gas-price", "0", "--host", "0.0.0.0"]
    networks:
      - veri-frame-net

  ipfs-node:
    image: ipfs/kubo:latest
    container_name: ipfs-node
    ports:
      - "4001:4001"       # swarm
      - "5001:5001"       # API
      - "8080:8080"       # gateway
    volumes:
      - ipfs_data:/data/ipfs
    networks:
      - veri-frame-net

  worker:
    build:
      context: ../worker
      dockerfile: Dockerfile
    container_name: render-worker
    environment:
      - STARKNET_RPC=http://starknet-devnet:5050
      - IPFS_API=http://ipfs-node:5001
      - JOB_REGISTRY_ADDRESS=0x0
      - WORKER_PRIVATE_KEY=0xabc123...
      - WORKER_ACCOUNT_ADDRESS=0xdef456...
    depends_on:
      - starknet-devnet
      - ipfs-node
    networks:
      - veri-frame-net
    volumes:
      - ../worker:/app

volumes:
  ipfs_data:

networks:
  veri-frame-net:
    driver: bridge
